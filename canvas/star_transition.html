<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Star</title>
</head>
<body>

<canvas id="canvas"
        style="
            border: 1px solid #aaa;
            display: block;
            margin: 50px auto"
>
    当前浏览器不支持canvas，请更换浏览器再试
</canvas>

<script>

    window.onload = function () {
        var canvas = document.getElementById('canvas')
        canvas.width = 800
        canvas.height = 600
        var ctx = canvas.getContext('2d')

        // ctx.lineWidth = 5
        // ctx.strokeStyle = 'red'

        // ctx.fillStyle = "black"

        // 1 线性渐变
        // var skyStyle = ctx.createLinearGradient(0, 0, 0, canvas.height)
        // 2 径向渐变
        var skyStyle = ctx.createRadialGradient(
            canvas.width / 2, canvas.height, 0,
            canvas.width / 2, canvas.height, 500
        )

        skyStyle.addColorStop(0, '#035')
        skyStyle.addColorStop(1, 'black')


        ctx.fillStyle = skyStyle

        // 直接绘制填充矩形 = （ctx.rect + ctx.fill)
        ctx.fillRect(0, 0, canvas.width, canvas.height)

        ctx.lineJoin = "miter"
        ctx.miterLimit = 20    // 连接处内角和外角顶点距离
        // 一般把定义线宽，颜色等属性放在外面，函数只负责画图形。这样可以在外面方便的调节

        for (let i = 0; i < 200; i++) {
            let r = Math.random() * 5 + 5
            let x = Math.random() * (canvas.width - r * 2) + r
            let y = Math.random() * (canvas.height * 0.65 - r * 2) + r
            let a = Math.random() * 360
            star(ctx, x, y, r, a)
        }
    }

    function star(ctx, x, y, R, rot) {
        // 用save + restore保证图形变换对外部无影响
        ctx.save()

        // 基于状态，先做图形的变换，再绘制
        // ctx.translate(x, y)
        // ctx.rotate(rot / 180 * Math.PI)
        // ctx.scale(R, R)

        // 上面1,3句可以用下面代替
        ctx.transform(R, 0, 0, R, x, y)
        // 基础绘制
        starPath(ctx)

        ctx.fillStyle = '#fb3'
        // ctx.strokeStyle = '#fd5'
        // ctx.lineWidth = 3
        // ctx.lineJoin = 'round'

        ctx.fill()
        // ctx.stroke()

        ctx.restore()
    }

    // 利用图形变换的思路：具体形状函数只负责基础绘制，其他变形由外部图形变换控制
    function starPath(ctx) {
        // ctx.moveTo(x, y - R)
        ctx.beginPath()

        for (let i = 0; i < 5; i++) {
            let inAngle = (54 - 72 * i) * Math.PI / 180
            let outAngle = (18 - 72 * i) * Math.PI / 180

            ctx.lineTo(Math.cos(inAngle) * 0.5, -Math.sin(inAngle) * 0.5)
            ctx.lineTo(Math.cos(outAngle), -Math.sin(outAngle))
        }
        ctx.closePath()
    }

</script>

</body>
</html>
